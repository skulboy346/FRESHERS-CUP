<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUESA FRESHER'S CUP '26</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="icon" href="edulogo.jpg" type="image/jpeg">
    <style>
        body { font-family: 'Rajdhani', sans-serif; background-color: #050505; color: white; }
        .font-cyber { font-family: 'Orbitron', sans-serif; }
        .text-fire { background: -webkit-linear-gradient(#f59e0b, #ef4444); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .input-fire { background: #1a1a1a; border: 1px solid #404040; color: white; transition: 0.3s; font-weight: bold; }
        .input-fire:focus { border-color: #f59e0b; outline: none; background: #000; }
        .btn-fire { animation: pulse 2s infinite; } 
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239,68,68,0.7); } 70% { box-shadow: 0 0 0 10px rgba(239,68,68,0); } 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0); } }
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-content { display: inline-block; animation: marquee 20s linear infinite; } @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .modal { transition: opacity 0.3s ease; } .modal.hidden { opacity: 0; pointer-events: none; } .modal.flex { opacity: 1; pointer-events: auto; }
        .anticipate-anim { animation: glow 2s infinite alternate; } @keyframes glow { from { text-shadow: 0 0 10px #f97316; } to { text-shadow: 0 0 20px #ef4444; } }
        .sidebar-glass { background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .breathing-logo { animation: breathe 3s ease-in-out infinite; }
        @keyframes breathe { 0% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(249, 115, 22, 0.5)); } 50% { transform: scale(1.05); filter: drop-shadow(0 0 25px rgba(249, 115, 22, 0.8)); } 100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(249, 115, 22, 0.5)); } }
        .text-fire-glow { animation: fire-pulse 2s infinite alternate ease-in-out; }
        @keyframes fire-pulse { 0% { text-shadow: 0 0 5px #f97316, 0 0 15px #ef4444; color: #fff; } 50% { text-shadow: 0 0 20px #eab308, 0 0 30px #f97316; color: #ffedd5; } 100% { text-shadow: 0 0 5px #f97316, 0 0 15px #ef4444; color: #fff; } }
    </style>
</head>
<body class="bg-[url('https://images.unsplash.com/photo-1517466787929-bc90951d0974?q=80&w=2000')] bg-cover bg-center bg-fixed min-h-screen flex flex-col relative">

    <div class="absolute inset-0 bg-black/90 z-0"></div>

    <img id="display-freshers-logo" src="edulogo.jpg" class="fixed top-24 left-4 md:left-8 w-24 h-24 md:w-36 md:h-36 z-40 breathing-logo object-contain hidden md:block filter drop-shadow-2xl">
    <div class="fixed top-24 right-4 md:right-8 z-40 hidden md:block breathing-logo">
        <div class="bg-black/40 backdrop-blur-md border-2 border-yellow-500/50 rounded-full p-2 shadow-2xl flex items-center justify-center w-20 h-20 md:w-28 md:h-28">
            <img id="display-nuesa-logo" src="edulogo.jpg" class="w-full h-full object-contain rounded-full">
        </div>
    </div>

    <button onclick="openModal('login-choice')" class="fixed bottom-8 right-8 z-50 group">
        <div class="bg-gradient-to-r from-gray-900 to-black text-white w-14 h-14 flex items-center justify-center rounded-full shadow-2xl border-2 border-orange-600 btn-fire transition transform group-hover:scale-110">
            <i class="fa-solid fa-users-gear text-xl text-orange-500 group-hover:text-white transition"></i>
        </div>
        <span class="absolute right-16 top-4 bg-black/90 text-white text-[10px] font-bold px-3 py-1 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap border border-gray-500 shadow-lg">
            PORTAL ACCESS
        </span>
    </button>

    <div class="relative z-10 bg-gradient-to-r from-red-900 to-black py-3 px-4 flex justify-between items-center border-b border-red-800 shadow-lg">
        <span class="text-xs font-bold tracking-widest text-orange-400 font-cyber hidden md:block drop-shadow-md">OFFICIAL NUESA SPORTS PLATFORM</span>
        <div class="flex space-x-5 text-white text-sm">
            <a href="https://www.instagram.com/theambassadors_sport?igsh=NjZrdnE1ZXhkang=" target="_blank" class="hover:text-pink-500 transition transform hover:scale-110"><i class="fa-brands fa-instagram"></i></a>
            <a href="https://www.facebook.com/profile.php?id=61583536988203" target="_blank" class="hover:text-blue-500 transition transform hover:scale-110"><i class="fa-brands fa-facebook"></i></a>
            <a href="https://x.com/Ambassador30788?t=jMIhwr41PFXhuY2Q1gGWKg&s=09" target="_blank" class="hover:text-gray-400 transition transform hover:scale-110"><i class="fa-brands fa-x-twitter"></i></a>
            <a href="https://www.tiktok.com/@theambassadors_sport?_r=1&_t=ZS-91HkO4CoTOJ" target="_blank" class="hover:text-pink-400 transition transform hover:scale-110"><i class="fa-brands fa-tiktok"></i></a>
            <a href="https://youtube.com/@theambassadorsport?si=31duWmdmjbjGCSLI" target="_blank" class="hover:text-red-600 transition transform hover:scale-110"><i class="fa-brands fa-youtube"></i></a>
            <a href="https://wa.me/2348113032943" target="_blank" class="hover:text-green-500 transition transform hover:scale-110"><i class="fa-brands fa-whatsapp"></i></a>
        </div>
    </div>

    <div class="relative z-10 bg-black border-b border-gray-700 py-1.5 overflow-hidden"><div class="marquee-container"><div class="marquee-content text-sm font-bold text-white uppercase tracking-widest drop-shadow-md">üî• Education Population 3000+ &nbsp;&nbsp; | &nbsp;&nbsp; ‚ö° 8 Departments &nbsp;&nbsp; | &nbsp;&nbsp; üèÜ 20+ Cohorts &nbsp;&nbsp; | &nbsp;&nbsp; ‚öΩ NUESA FRESHER'S CUP '26 &nbsp;&nbsp; | &nbsp;&nbsp; üìÖ COMING SOON</div></div></div>

    <main class="relative z-10 flex-grow flex flex-col items-center justify-start p-4 pt-8 w-full max-w-6xl mx-auto">
        
        <div class="text-center mb-10 w-full">
            <h1 class="text-4xl md:text-6xl font-black font-cyber text-white mb-2 italic tracking-tighter leading-tight drop-shadow-lg">
                NUESA <span class="text-fire">FRESHER'S CUP '26</span>
            </h1>
            <p class="text-fire-glow text-sm uppercase tracking-[0.3em] font-bold mb-8">The Battle of the Freshmen</p>
            
            <div id="countdown-wrapper" class="max-w-lg mx-auto bg-black/60 border border-orange-500/50 p-6 rounded-xl backdrop-blur-md mb-8 min-h-[100px] flex items-center justify-center shadow-xl">
                <div id="clock-display" class="grid grid-cols-4 gap-4 w-full hidden">
                    <div class="text-center"><span id="d" class="block text-3xl font-black text-white">00</span><span class="text-[10px] text-gray-300 font-bold uppercase">Days</span></div>
                    <div class="text-center"><span id="h" class="block text-3xl font-black text-white">00</span><span class="text-[10px] text-gray-300 font-bold uppercase">Hrs</span></div>
                    <div class="text-center"><span id="m" class="block text-3xl font-black text-white">00</span><span class="text-[10px] text-gray-300 font-bold uppercase">Mins</span></div>
                    <div class="text-center"><span id="s" class="block text-3xl font-black text-orange-500">00</span><span class="text-[10px] text-gray-300 font-bold uppercase">Secs</span></div>
                </div>
                <div id="anticipation-display" class="hidden text-center">
                    <h2 class="text-3xl font-black text-white font-cyber anticipate-anim tracking-widest">ANTICIPATION</h2>
                    <p class="text-[10px] text-orange-400 uppercase tracking-widest mt-2 font-bold">THE HEAT IS COMING</p>
                </div>
                <div id="loading-display"><i class="fa-solid fa-circle-notch fa-spin text-orange-500 text-2xl"></i></div>
            </div>

            <div class="flex justify-center gap-3 mb-8 flex-wrap">
                <button onclick="openModal('fixtures')" class="bg-gray-800 border border-gray-500 px-6 py-3 rounded font-bold text-white text-xs tracking-wider hover:bg-orange-600 hover:border-orange-600 transition hover:shadow-lg hover:shadow-orange-900/50">üìÖ FIXTURES</button>
                <button onclick="openModal('results')" class="bg-gray-800 border border-gray-500 px-6 py-3 rounded font-bold text-white text-xs tracking-wider hover:bg-green-600 hover:border-green-600 transition hover:shadow-lg hover:shadow-green-900/50">‚úÖ RESULTS</button>
                <button onclick="openModal('brackets')" class="bg-gray-800 border border-gray-500 px-6 py-3 rounded font-bold text-white text-xs tracking-wider hover:bg-cyan-600 hover:border-cyan-600 transition hover:shadow-lg hover:shadow-cyan-900/50">üèÜ BRACKETS</button>
                <button onclick="openModal('medals')" class="bg-yellow-600 border border-yellow-400 px-6 py-3 rounded font-bold text-black text-xs tracking-wider hover:bg-yellow-500 transition shadow-lg shadow-yellow-900/50">ü•á MEDAL TABLE</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 w-full">
            <div id="dynamic-area" class="lg:col-span-2"></div>
            <div class="lg:col-span-1">
                <div class="sidebar-glass rounded-xl p-6 shadow-2xl border-t-4 border-yellow-500">
                    <h3 class="text-lg font-black text-white font-cyber mb-5 flex items-center gap-2 border-b border-gray-700 pb-2">
                        <i class="fa-solid fa-trophy text-yellow-500"></i> TOP 4 RANKING
                    </h3>
                    <div id="sidebar-standings" class="space-y-3 mb-6"><p class="text-center text-gray-300 text-xs py-4">Loading standings...</p></div>
                    <button onclick="openModal('medals')" class="w-full bg-white/10 hover:bg-white/20 text-white font-bold py-3 rounded text-xs uppercase transition border border-gray-500">VIEW FULL TABLE</button>
                </div>
            </div>
        </div>

        <div class="w-full mt-16 mb-8 text-center">
            <h3 class="text-xl font-black text-white italic sport-font tracking-tight mb-6 drop-shadow-md">FUEL THE PASSION</h3>
            <p class="text-[10px] text-gray-400 uppercase tracking-widest mb-6">Official Partners & Sponsors</p>
            <div id="sponsors-grid" class="flex flex-wrap justify-center items-center gap-6"></div>
            <div class="text-center mt-8">
                <a href="https://wa.me/2348113032943?text=Hello%20I%20want%20to%20sponsor%20NUESA%20CUP" target="_blank" class="inline-block bg-gradient-to-r from-yellow-500 to-orange-500 text-black font-black px-10 py-4 rounded transform skew-x-[-10deg] hover:scale-105 transition shadow-xl btn-fire border border-white/20"><span class="skew-x-[10deg]">BECOME A SPONSOR</span></a>
            </div>
        </div>
    </main>

    <footer class="relative z-10 bg-black text-center py-8 border-t border-gray-800"><p class="text-gray-400 text-xs font-bold uppercase mb-1">¬© 2025/26 NUESA Sports Committee.</p><p class="text-gray-500 text-[10px] font-bold tracking-widest">POWERED BY THE AMBASSADOR'S SPORTS</p></footer>

    <div id="info-modal" class="fixed inset-0 z-50 bg-black/95 hidden flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-gray-900 w-full max-w-3xl rounded-2xl border border-gray-600 h-[85vh] flex flex-col shadow-2xl">
            <div class="p-5 border-b border-gray-700 flex justify-between items-center bg-gray-800/50 rounded-t-2xl"><h2 id="modal-title" class="text-2xl font-black text-white font-cyber uppercase tracking-wider">TITLE</h2><button onclick="document.getElementById('info-modal').classList.add('hidden')" class="text-gray-300 hover:text-white transition"><i class="fa-solid fa-times text-2xl"></i></button></div>
            <div id="modal-content" class="flex-grow overflow-y-auto p-5 space-y-4"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, query, where, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDpkYhtnx7163HgP7IaSy0Uy5lz9DCO-0A", authDomain: "freshers-cup-2026.firebaseapp.com", projectId: "freshers-cup-2026", storageBucket: "freshers-cup-2026.firebasestorage.app", messagingSenderId: "926375023026", appId: "1:926375023026:web:d1ad62dede7425900354ab", measurementId: "G-Z53G2Y9BTM" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app);

        let deptLogos = {}; 

        async function init() {
            try { 
                const snap = await getDoc(doc(db, "app_content", "dept_logos")); 
                if (snap.exists()) deptLogos = snap.data(); 
                const bSnap = await getDoc(doc(db, "app_content", "brand_logos"));
                if (bSnap.exists()) {
                    if(bSnap.data().nuesa_logo) document.getElementById('display-nuesa-logo').src = bSnap.data().nuesa_logo;
                    if(bSnap.data().freshers_logo) document.getElementById('display-freshers-logo').src = bSnap.data().freshers_logo;
                }
            } catch(e){ console.log("Init error", e); }
            initCountdown(); loadTop4(); loadSponsors();
        }
        init();

        // --- 1. COUNTDOWN ---
        async function initCountdown() {
            const s = await getDoc(doc(db,"app_content","fc_settings")); let targetDate = new Date().getTime() + 864000000; if(s.exists() && s.data().countdownTarget) { targetDate = new Date(s.data().countdownTarget).getTime(); }
            const clockEl = document.getElementById('clock-display'); const antiEl = document.getElementById('anticipation-display'); document.getElementById('loading-display').classList.add('hidden');
            setInterval(() => {
                const now = new Date().getTime(); const dist = targetDate - now; const daysLeft = Math.floor(dist / (1000 * 60 * 60 * 24));
                if (daysLeft > 10) { clockEl.classList.add('hidden'); antiEl.classList.remove('hidden'); } else { antiEl.classList.add('hidden'); clockEl.classList.remove('hidden'); if(dist < 0) return; document.getElementById('d').innerText = daysLeft.toString().padStart(2,'0'); document.getElementById('h').innerText = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2,'0'); document.getElementById('m').innerText = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2,'0'); document.getElementById('s').innerText = Math.floor((dist % (1000 * 60)) / 1000).toString().padStart(2,'0'); }
            }, 1000);
        }

        // --- 2. SPONSORS ---
        async function loadSponsors() {
            const container = document.getElementById('sponsors-grid'); container.innerHTML = ''; const q = query(collection(db, "fc_sponsors"), orderBy("timestamp", "desc")); const snap = await getDocs(q);
            snap.forEach(doc => { const s = doc.data(); const border = s.type === 'Partner' ? 'border-yellow-500/50 shadow-yellow-900/20 shadow-lg' : 'border-gray-800'; const badge = s.type === 'Partner' ? '<span class="absolute -top-2 -right-2 bg-yellow-500 text-black text-[8px] font-bold px-2 py-0.5 rounded-full">PARTNER</span>' : '<span class="absolute -top-2 -right-2 bg-gray-600 text-white text-[8px] font-bold px-2 py-0.5 rounded-full">SPONSOR</span>'; container.innerHTML += `<a href="${s.link}" target="_blank" class="relative h-20 w-32 bg-black/50 border ${border} rounded-lg flex items-center justify-center p-2 hover:scale-105 transition">${badge}<img src="${s.logo}" class="max-h-full max-w-full object-contain"></a>`; });
        }

        // --- 3. SIDEBAR ---
        async function loadTop4() {
            const list = document.getElementById('sidebar-standings'); const snap = await getDoc(doc(db, "app_content", "medal_table"));
            if (!snap.exists()) { list.innerHTML = '<p class="text-center text-gray-400 text-xs">No Data Available.</p>'; return; }
            const data = snap.data(); const sorted = Object.keys(data).map(k => ({id: k, ...data[k]})).sort((a,b) => (b.g - a.g) || (b.s - a.s) || (b.b - a.b)).slice(0, 4);
            list.innerHTML = '';
            sorted.forEach((d, i) => { const logo = deptLogos[d.id] || 'edulogo.jpg'; const rankColor = i===0?'text-yellow-400':(i===1?'text-gray-300':(i===2?'text-orange-500':'text-white')); list.innerHTML += `<div class="flex items-center justify-between bg-white/5 p-3 rounded border border-gray-600/50 hover:bg-white/10 transition"><div class="flex items-center gap-3"><span class="font-black text-xl ${rankColor}">${i+1}</span><img src="${logo}" class="h-8 w-8 object-contain bg-white/10 rounded-full p-1"><span class="font-bold text-base text-white">${d.id}</span></div><div class="flex gap-3 text-xs font-bold"><span class="text-yellow-400">${d.g}G</span><span class="text-gray-300">${d.s}S</span><span class="text-orange-600">${d.b}B</span></div></div>`; });
        }

        // --- 4. REGISTRATION ---
        const deptMap = { "AESA": "Adult Edu", "NAAES": "Arts Edu", "EFSA": "Edu Found", "EMSA": "Edu Mgt", "HKHE": "Human Kinetics", "ULSESA": "Science Edu", "SESSA": "Soc Sci", "TVESA": "Vocational" };
        const urlParams = new URLSearchParams(window.location.search); const deptId = urlParams.get('d'); const area = document.getElementById('dynamic-area');
        window.updateSportsOptions = () => { const g = document.getElementById('gender').value, b = document.getElementById('ballGame'); b.innerHTML = '<option value="None">None</option>'; if(g==="Male")b.innerHTML+='<option value="Football">Football (Male)</option>'; if(g==="Female")b.innerHTML+='<option value="Futsal">Futsal (Female)</option>'; };

        if(!deptId || !deptMap[deptId]) { area.innerHTML = `<div class="bg-black/70 backdrop-blur-md border border-gray-700 rounded-2xl p-8 text-center shadow-2xl"><i class="fa-solid fa-lock text-5xl text-gray-500 mb-4"></i><h2 class="text-2xl font-bold text-white mb-2">REGISTRATION LOCKED</h2><p class="text-gray-300 text-sm mb-6">Participation is exclusively for Freshers of the 8 Departments. You need a unique invite link from your Sports Secretary to register.</p><div class="inline-block bg-gray-900 border border-gray-600 rounded-lg p-4"><p class="text-[10px] text-gray-400 uppercase font-bold tracking-widest mb-2">Participating Departments</p><div class="flex flex-wrap justify-center gap-2">${Object.values(deptMap).map(n => `<span class="text-[10px] bg-gray-800 text-gray-200 px-2 py-1 rounded border border-gray-700">${n}</span>`).join('')}</div></div></div>`; }
        else {
            area.innerHTML = `<div class="bg-black/80 backdrop-blur-md border border-orange-900/50 rounded-2xl p-8 shadow-2xl"><div class="text-center mb-6"><div class="inline-block bg-orange-900/30 text-orange-400 px-4 py-1 rounded-full text-sm font-bold uppercase border border-orange-500/50">${deptMap[deptId]}</div></div><form id="regForm" class="space-y-4"><input type="text" id="fullname" required class="w-full p-3 rounded input-fire" placeholder="Full Name (Surname First)"><input type="number" id="matric" required class="w-full p-3 rounded input-fire" placeholder="Matric Number"><input type="email" id="email" required class="w-full p-3 rounded input-fire" placeholder="Email Address"><input type="tel" id="phone" required class="w-full p-3 rounded input-fire" placeholder="WhatsApp Number"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><select id="role" required class="w-full p-3 rounded input-fire"><option value="Player">Player</option><option value="Coach">Coach</option></select><select id="gender" required class="w-full p-3 rounded input-fire" onchange="updateSportsOptions()"><option value="">Select Gender</option><option value="Male">Male</option><option value="Female">Female</option></select></div><div class="bg-gray-900/80 p-4 rounded-xl border border-gray-700"><p class="text-xs font-bold text-gray-400 mb-2 uppercase">Select Sports</p><div class="mb-3"><label class="text-xs text-orange-500 font-bold block mb-1">BALL GAME</label><select id="ballGame" class="w-full p-2 rounded input-fire text-sm"><option value="None">None</option></select></div><div><label class="text-xs text-yellow-500 font-bold block mb-1">BOARD GAMES (Max 2)</label><div class="grid grid-cols-2 gap-2 text-sm text-gray-300"><label><input type="checkbox" name="board" value="Chess"> Chess</label><label><input type="checkbox" name="board" value="Scrabble"> Scrabble</label><label><input type="checkbox" name="board" value="Ludo"> Ludo</label><label><input type="checkbox" name="board" value="Ayo"> Ayo</label></div></div></div><div class="text-xs text-gray-400 space-y-2"><label class="flex gap-2"><input type="checkbox" required> Details Correct</label><label class="flex gap-2"><input type="checkbox" required> Fit to Play</label></div><button type="submit" id="submitBtn" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-black py-4 rounded-xl text-lg transition shadow-lg btn-fire">REGISTER</button></form></div>`;
            const checks = document.getElementsByName('board'); checks.forEach(c => c.addEventListener('change', () => { if(document.querySelectorAll('input[name="board"]:checked').length > 2) { c.checked = false; alert("Max 2 Board Games!"); } }));
            document.getElementById('regForm').addEventListener('submit', async (e) => { e.preventDefault(); const btn = document.getElementById('submitBtn'); btn.disabled = true; btn.innerText = "PROCESSING..."; const matric = document.getElementById('matric').value, ball = document.getElementById('ballGame').value, role = document.getElementById('role').value, boards = []; document.querySelectorAll('input[name="board"]:checked').forEach(c => boards.push(c.value)); if(!matric.startsWith('2503')) { alert("Invalid Matric (Must start with 2503)"); btn.disabled=false; btn.innerText="REGISTER"; return; } if(ball === "None" && boards.length === 0 && role !== "Coach") { alert("Select a sport!"); btn.disabled=false; btn.innerText="REGISTER"; return; } try { const col = collection(db, "fresher_cup_26"); if(ball !== "None") { const q = query(col, where("deptId", "==", deptId), where("ballGame", "==", ball), where("role", "==", role)); const snap = await getDocs(q); const limit = role === "Coach" ? 1 : 10; if(snap.size >= limit) throw new Error(`${role} slots for ${ball} are full!`); } for(const g of boards) { const q = query(col, where("deptId", "==", deptId), where("boardGames", "array-contains", g)); if((await getDocs(q)).size >= 1) throw new Error(`${g} taken!`); } await addDoc(col, { fullname: document.getElementById('fullname').value, matric, email: document.getElementById('email').value, phone: document.getElementById('phone').value, role, gender: document.getElementById('gender').value, deptId, deptName: deptMap[deptId], ballGame: ball, boardGames: boards, timestamp: serverTimestamp() }); alert("‚úÖ REGISTERED!"); window.location.reload(); } catch(err) { console.error(err); alert("‚ö†Ô∏è " + err.message); btn.disabled = false; btn.innerText = "REGISTER"; } });
        }

        // --- 5. MODALS & VISUALIZERS ---
        window.openModal = async (type) => {
            const modal = document.getElementById('info-modal'); const title = document.getElementById('modal-title'); const content = document.getElementById('modal-content');
            modal.classList.remove('hidden'); modal.classList.add('flex'); content.innerHTML = '<p class="text-gray-300 text-center">Loading...</p>';

            // üî• LOGIN CHOICE
            if (type === 'login-choice') {
                title.innerText = "PORTAL ACCESS";
                content.innerHTML = `
                    <div class="flex flex-col gap-4 items-center justify-center h-64">
                        <p class="text-gray-400 mb-4 text-sm">SELECT YOUR ROLE TO CONTINUE</p>
                        <button onclick="window.location.href='admin.html'" class="w-3/4 bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl shadow-lg border border-orange-500 transition transform hover:scale-105 flex items-center justify-center gap-3"><i class="fa-solid fa-lock"></i> MASTER ADMIN</button>
                        <button onclick="window.location.href='dept_portal.html'" class="w-3/4 bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 rounded-xl shadow-lg border border-gray-600 transition transform hover:scale-105 flex items-center justify-center gap-3"><i class="fa-solid fa-users-gear"></i> SPORT SECRETARY</button>
                    </div>
                `;
            }
            // ... (Other Modals: Brackets, Medals, Fixtures, Results) ...
            else if (type === 'brackets') {
                title.innerText = "TOURNAMENT DRAW"; content.innerHTML = `<div class="mb-4 text-center"><select id="bracket-sport" class="bg-gray-800 text-white border border-gray-500 rounded px-4 py-2 text-sm font-bold shadow-md" onchange="renderBracket(this.value)"><option value="Football">Football</option><option value="Futsal">Futsal</option><option value="Chess">Chess</option><option value="Scrabble">Scrabble</option><option value="Ludo">Ludo</option><option value="Ayo">Ayo</option></select></div><div id="bracket-container" class="flex flex-col gap-6 items-center p-4">Loading...</div>`; window.renderBracket('Football');
            } 
            else if (type === 'medals') {
                title.innerText = "OFFICIAL MEDAL TABLE"; const snap = await getDoc(doc(db, "app_content", "medal_table")); if (!snap.exists()) return content.innerHTML='<p class="text-gray-300 text-center">No data.</p>'; const sorted = Object.keys(snap.data()).map(k => ({id: k, ...snap.data()[k]})).sort((a,b) => (b.g - a.g) || (b.s - a.s) || (b.b - a.b)); let html = `<div class="overflow-x-auto"><table class="w-full text-left text-sm text-gray-200"><thead class="bg-white/10 text-orange-400 uppercase text-xs"><tr><th class="p-4">Rank</th><th class="p-4">Dept</th><th class="p-4 text-center">ü•á</th><th class="p-4 text-center">ü•à</th><th class="p-4 text-center">ü•â</th><th class="p-4 text-center">Tot</th></tr></thead><tbody class="divide-y divide-gray-700">`; sorted.forEach((d, i) => { const logo = deptLogos[d.id] || 'edulogo.jpg'; html += `<tr class="hover:bg-white/5"><td class="p-4 font-bold text-lg">${i+1}</td><td class="p-4 font-bold text-white flex items-center gap-3"><img src="${logo}" class="h-8 w-8 object-contain bg-white/10 rounded p-1">${d.id}</td><td class="p-4 text-center font-bold text-yellow-400 text-lg">${d.g}</td><td class="p-4 text-center font-bold text-gray-300 text-lg">${d.s}</td><td class="p-4 text-center font-bold text-orange-500 text-lg">${d.b}</td><td class="p-4 text-center font-black text-white text-lg">${d.g+d.s+d.b}</td></tr>`; }); html += `</tbody></table></div>`; content.innerHTML = html;
            }
            else if (type === 'fixtures') {
                title.innerText = "UPCOMING FIXTURES"; const q = query(collection(db, "fc_fixtures"), where("status", "==", "Scheduled"), orderBy("date", "asc")); const snap = await getDocs(q); content.innerHTML = snap.empty ? '<p class="text-gray-300 text-center">No matches scheduled.</p>' : ''; snap.forEach(d => { const m = d.data(); const lA = deptLogos[m.tA]||'edulogo.jpg'; const lB = deptLogos[m.tB]||'edulogo.jpg'; content.innerHTML += `<div class="bg-white/5 p-5 rounded-xl border border-gray-600 mb-3 hover:border-orange-500 transition"><div class="flex justify-between text-xs text-gray-300 mb-2 font-bold uppercase tracking-wider"><span>${m.sport}</span><span class="text-orange-400">${m.stage}</span></div><div class="flex justify-between items-center"><div class="w-1/3 text-right flex items-center justify-end gap-3"><span class="font-bold text-white text-lg">${m.tA}</span><img src="${lA}" class="h-10 w-10 object-contain bg-white/10 rounded p-1"></div><span class="bg-gray-700 px-3 py-1 rounded text-orange-500 font-black text-sm">VS</span><div class="w-1/3 text-left flex items-center justify-start gap-3"><img src="${lB}" class="h-10 w-10 object-contain bg-white/10 rounded p-1"><span class="font-bold text-white text-lg">${m.tB}</span></div></div><div class="text-center text-xs text-gray-300 mt-3 font-bold border-t border-gray-700 pt-2"><i class="fa-regular fa-clock mr-1"></i> ${new Date(m.date).toLocaleString()} <span class="mx-2">|</span> <i class="fa-solid fa-location-dot mr-1"></i> ${m.venue}</div></div>`; });
            }
            else if (type === 'results') {
                title.innerText = "MATCH RESULTS"; const q = query(collection(db, "fc_fixtures"), where("status", "==", "FT"), orderBy("date", "desc")); const snap = await getDocs(q); content.innerHTML = snap.empty ? '<p class="text-gray-300 text-center">No results.</p>' : ''; snap.forEach(d => { const m = d.data(); const lA = deptLogos[m.tA]||'edulogo.jpg'; const lB = deptLogos[m.tB]||'edulogo.jpg'; content.innerHTML += `<div class="bg-white/5 p-5 rounded-xl border border-gray-600 mb-3"><div class="flex justify-between text-xs text-gray-300 mb-2 font-bold uppercase tracking-wider"><span>${m.sport}</span><span class="text-green-400">${m.stage}</span></div><div class="flex justify-between items-center"><div class="w-1/3 text-right flex items-center justify-end gap-3"><span class="font-bold text-white text-lg">${m.tA}</span><img src="${lA}" class="h-10 w-10 object-contain bg-white/10 rounded p-1"></div><div class="bg-black/50 border border-gray-600 px-4 py-2 rounded-lg text-2xl font-black text-white tracking-widest shadow-inner">${m.scoreA} - ${m.scoreB}</div><div class="w-1/3 text-left flex items-center justify-start gap-3"><img src="${lB}" class="h-10 w-10 object-contain bg-white/10 rounded p-1"><span class="font-bold text-white text-lg">${m.tB}</span></div></div><div class="text-center text-[10px] text-green-400 font-bold mt-3 uppercase tracking-widest">FULL TIME</div></div>`; });
            }
        }

        window.renderBracket = async (sport) => {
            const container = document.getElementById('bracket-container'); container.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin text-orange-500 text-2xl"></i>'; const snap = await getDoc(doc(db, "app_content", `draw_${sport}`)); if (!snap.exists()) { container.innerHTML = '<p class="text-gray-400 text-sm">Bracket not released.</p>'; return; } const d = snap.data(); const team = (id) => deptLogos[id] ? `<div class="flex items-center gap-2 justify-center bg-black/30 px-2 py-1 rounded border border-gray-600"><img src="${deptLogos[id]}" class="h-5 w-5 object-contain"><span>${id}</span></div>` : id;
            container.innerHTML = `<div class="w-full grid grid-cols-2 gap-3 mb-6"><div class="bg-gray-800 p-3 rounded text-xs text-gray-300 border border-gray-600 text-center"><p class="text-[9px] text-orange-400 font-bold mb-2 uppercase tracking-widest">GROUP A</p><div class="flex justify-center items-center gap-1">${team(d.a1)} <span class="text-[8px] text-gray-500">vs</span> ${team(d.a2)}</div></div><div class="bg-gray-800 p-3 rounded text-xs text-gray-300 border border-gray-600 text-center"><p class="text-[9px] text-orange-400 font-bold mb-2 uppercase tracking-widest">GROUP B</p><div class="flex justify-center items-center gap-1">${team(d.b1)} <span class="text-[8px] text-gray-500">vs</span> ${team(d.b2)}</div></div><div class="bg-gray-800 p-3 rounded text-xs text-gray-300 border border-gray-600 text-center"><p class="text-[9px] text-orange-400 font-bold mb-2 uppercase tracking-widest">GROUP C</p><div class="flex justify-center items-center gap-1">${team(d.c1)} <span class="text-[8px] text-gray-500">vs</span> ${team(d.c2)}</div></div><div class="bg-gray-800 p-3 rounded text-xs text-gray-300 border border-gray-600 text-center"><p class="text-[9px] text-orange-400 font-bold mb-2 uppercase tracking-widest">GROUP D</p><div class="flex justify-center items-center gap-1">${team(d.d1)} <span class="text-[8px] text-gray-500">vs</span> ${team(d.d2)}</div></div></div><i class="fa-solid fa-arrow-down text-gray-500 mb-4 text-lg"></i><div class="flex justify-between w-full max-w-lg gap-4 mb-6"><div class="bg-black/40 border border-cyan-500/50 p-3 rounded w-1/2 text-center shadow-lg"><p class="text-[10px] text-cyan-400 font-bold mb-2 uppercase tracking-widest">SEMI FINAL 1</p><div class="text-white text-xs font-bold flex justify-center items-center gap-1">${team(d.sf1h)} <span class="text-gray-500 text-[8px]">vs</span> ${team(d.sf1a)}</div></div><div class="bg-black/40 border border-cyan-500/50 p-3 rounded w-1/2 text-center shadow-lg"><p class="text-[10px] text-cyan-400 font-bold mb-2 uppercase tracking-widest">SEMI FINAL 2</p><div class="text-white text-xs font-bold flex justify-center items-center gap-1">${team(d.sf2h)} <span class="text-gray-500 text-[8px]">vs</span> ${team(d.sf2a)}</div></div></div><i class="fa-solid fa-trophy text-yellow-500 text-3xl animate-bounce mb-4 filter drop-shadow-lg"></i><div class="bg-gradient-to-r from-yellow-900/40 to-orange-900/40 border border-yellow-500 p-6 rounded-2xl w-full max-w-sm text-center shadow-2xl"><p class="text-xs text-yellow-400 font-black tracking-[0.3em] mb-4 uppercase">GRAND FINAL</p><div class="flex justify-center items-center gap-4 text-white font-black text-xl"><div>${team(d.finh)}</div><span class="text-sm text-gray-400 font-light">VS</span><div>${team(d.fina)}</div></div></div>`;
        }
    </script>
</body>
</html>